# ACSAC2012-Generalized Vulnerability Extrapolation using Abstract Syntax Trees

# INTRO
- è¿™æ˜¯ä¸€ç¯‡2012å¹´çš„ACSACï¼Œ çœ‹è¿™ç¯‡æ–‡ç« æ˜¯æƒ³çœ‹ä»–å¦‚ä½•æŠŠASTæ˜ å°„åˆ°å‘é‡ç©ºé—´çš„ã€‚ç‰¹è‰²æ˜¯å°†æœºå™¨å­¦ä¹ ä¸é™æ€åˆ†æç›¸ç»“åˆã€‚
- è¿™æ˜¯fabsåšå£«å‘çš„ï¼Œ æˆ‘æ˜¯ä»–çš„å°è¿·å¼Ÿã€‚

# DESIGN

- æœ¬æ–‡ä¹Ÿæ˜¯ï¼Œ æå‡ºä¸€ç§è¾…åŠ©ä»£ç å®¡è®¡å·¥å…·ï¼Œ ç”¨æ¥å‘ç°æºç ä¸­çš„æ¼æ´ã€‚
- æ–¹æ³•æ˜¯é¦–å…ˆç”ŸæˆAST,ç„¶ååœ¨æ ‘ä¸Šå»æ‰¾æ¼æ´æ¨¡å¼ã€‚ï¼ˆä¸ºä»€ä¹ˆè¦ç”¨ASTè¿™å±‚, è¿™å±‚å¯èƒ½å¥½æå‘é‡ï¼Ÿ æˆ–è€…è¿™å±‚èƒ½å¤Ÿçªå‡ºä»£ç æ–‡æœ¬çš„ç»“æ„ï¼Ÿï¼‰ï¼ˆæ˜¯çš„ï¼Œ ASTä¿ç•™äº†è¯­æ³•ç»“æ„ä¿¡æ¯ä¸æ¯ä¸ªèŠ‚ç‚¹çš„å†…å®¹ä¿¡æ¯ï¼‰
- ä½œè€…åœ¨2011å¹´çš„wootä¸Šå‘è¡¨äº†ä¸€ç¯‡[1],è¿™ç¯‡æ–‡ç« é‡Œå°±æå‡ºäº†è¿™ä¸ª`vulnerability extrapolation`çš„æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•çš„æè¿°æ˜¯:`embedding code in a vector space and automatically determining API usage patterns using machine learning`ï¼ˆå°±æ˜¯è¯´å°†ä»£ç åµŒå…¥åˆ°å‘é‡ç©ºé—´ä¸­åˆ©ç”¨æœºå™¨å­¦ä¹ åšæ¼æ´åŒ¹é…ï¼‰

åœ¨æ–¹æ³•ä¸Šï¼Œ é¦–å…ˆéœ€è¦æ˜ç™½çš„æ˜¯ï¼Œ è¿™æ˜¯ä¸€ç§è¾…åŠ©æ€§çš„æ‰‹æ®µã€‚ æˆ‘è§‰å¾—è¿™å¯èƒ½æ˜¯fabsåšå£«codeminerçš„ç†å¿µ(è‡³å°‘åœ¨æ—©æœŸ)ï¼Œå³è‡ªåŠ¨åŒ–è¾…åŠ©äººå·¥å®¡è®¡ã€‚ æœ¬æ–‡è¾…åŠ©æ–¹æ³•æ˜¯é€šè¿‡ä»£ç ç›¸ä¼¼åº¦åŒ¹é…çš„æ–¹æ³•ï¼Œ é€šè¿‡æŠŠæœ¬é¡¹ç›®çš„ä¸€ä¸ªå·²çŸ¥æ¼æ´è§£ææˆè¯­æ³•æ ‘ï¼Œå†è¿›è¡Œä¸€ç³»åˆ—çš„å˜æ¢åæ˜ å°„åˆ°å‘é‡ç©ºé—´åã€‚ ç”¨åŒæ ·çš„æ–¹æ³•å¤„ç†æ‰€æœ‰å‡½æ•°ï¼Œ ç„¶åå»åŒ¹é…ç›¸ä¼¼åº¦ï¼Œè®¤ä¸ºï¼Œ ç›¸ä¼¼åº¦é«˜çš„å‡½æ•°å¯èƒ½åŒ…å«åŒæ ·çš„æ¼æ´ã€‚ä½œè€…åœ¨è¿›è¡Œç›¸ä¼¼åº¦åŒ¹é…çš„æ—¶å€™æ—¢ä¿ç•™äº†å†…å®¹ä¿¡æ¯ï¼Œ åˆä¿ç•™äº†è¯­æ³•ç»“æ„ã€‚å¯¹æ¯”äºredebug, vuddyè¿™ç§tokenåŒ–å¤„ç†æ¯”è¾ƒå‡½æ•°ç›¸ä¼¼åº¦çš„(plain),æˆ‘æƒ³è¿™ç§åšæ³•çš„å¥½å¤„å¯èƒ½æ˜¯æ¯”è¾ƒç²¾ç»†ï¼Œå½“ç„¶å‰è€…æ˜¯å¯ä»¥è·¨é¡¹ç›®æ¯”å¯¹çš„(ç†è®ºä¸Šï¼Œå®é™…æ•ˆæœå¯èƒ½è¿˜æ˜¯æœ‰è”ç³»çš„é¡¹ç›®ä½œç”¨ä¼šå¤§ä¸€ç‚¹)ã€‚ è€Œæœ¬æ–‡çš„æ–¹æ³•ï¼Œå†…å®¹ä¸Šä¸tokenåŒ–ï¼Œä¿ç•™åŸæ ‡è¯†ç¬¦ä¿¡æ¯æ¯”è¾ƒ(å› ä¸ºåŒé¡¹ç›®å¯èƒ½æ¼æ´è§¦å‘è·¯å¾„ä¸Šçš„å…³é”®å‡½æ•°éƒ½æ˜¯è°ƒç”¨çš„ä¸€ä¸ª)ï¼Œ åˆä¿ç•™äº†è¯­æ³•æ ‘ç»“æ„ã€‚ ç²¾åº¦ä¸Šåº”è¯¥ä¼šæ›´å¥½ä¸€äº›(ä½†æ˜¯ä¸€ä¸ªé¡¹ç›®çš„æ¼æ´ï¼Œåªèƒ½æ‰¾æœ¬é¡¹ç›®çš„)ã€‚

ç®€å•ä»‹ç»ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ï¼š
  
- æ€»æµç¨‹ï¼š 
  ![](https://penlab-1252869057.cos.ap-beijing.myqcloud.com/2019-12-07-060919.png)
  
- è¿™ç§æ–¹æ³•åˆ†äº†å››éƒ¨ï¼š
  - 1. Extraction of AST(è·å–è¯­æ³•æ ‘). å°†è¾“å…¥çš„code base ä»¥å‡½æ•°ä¸ºå•ä½ç”Ÿæˆè¯­æ³•æ ‘ã€‚ åˆ©ç”¨äº†ä¸€ç§`island grammars`æŠ€æœ¯ï¼Œæ­¤æŠ€æœ¯å¯¹äºc/c++ä»£ç ä¸éœ€è¦è€ƒè™‘ç¼–è¯‘ç¯å¢ƒæ—¢å¯ä»¥è¿›è¡Œè¯­æ³•è§£æã€‚å®ç°ä¸Šä½¿ç”¨äº†ANTLRåšä¸ºparserã€‚
  ç”Ÿæˆè¯­æ³•æ ‘ï¼š 
  ![](https://penlab-1252869057.cos.ap-beijing.myqcloud.com/2019-12-07-060804.png)
  ![](https://penlab-1252869057.cos.ap-beijing.myqcloud.com/2019-12-07-060809.png)
  å¯ä»¥çœ‹åˆ°ï¼Œbä¸ºä»£ç açš„åºåˆ—ç»“æ„ï¼Œ è€Œå›¾3ä¸ºå…¶å›¾å½¢ç»“æ„ã€‚åœ¨å›¾å½¢ç»“æ„ä¸­ï¼Œ æˆ‘ä»¬çœ‹åˆ°ä¸å…‰è§£ææˆè¯­æ³•æ ‘ï¼Œè¿˜å¯¹èŠ‚ç‚¹è¿›è¡Œäº†åˆ†ç±»: è™šçº¿èŠ‚ç‚¹åœ¨æ¯”è¾ƒä¸­æœ€é‡è¦(API nodes)ï¼Œæ ‡æ˜å’ŒAPIè°ƒç”¨æœ‰å…³çš„èŠ‚ç‚¹(å®å‚å£°æ˜ï¼Œ å˜é‡å£°æ˜ï¼Œ callèŠ‚ç‚¹)ï¼Œè€Œç‚¹çº¿æ˜¯è¯¥å‡½æ•°çš„ä¸€äº›è¯­æ³•ä¿¡æ¯(syntax nodes), å‰©ä¸‹çš„å®çº¿çš„æ˜¯no-syntax nodesã€‚ æ­¤ç§èŠ‚ç‚¹ç±»å‹åˆ’åˆ†åœ¨ä¸‹ä¸€æ­¥é‡Œæœ‰ç”¨ã€‚
  - 2. Embedding in a vector space. ä¸Šä¸€æ­¥æˆ‘ä»¬æˆ‘ä»¬æœ‰äº†è¯­æ³•æ ‘ï¼Œè¦è¿›è¡Œæœºå™¨å­¦ä¹ æ¯”å¯¹ï¼Œéœ€è¦å°†å…¶æ˜ å°„åˆ°å‘é‡ç©ºé—´ã€‚æ­¤æ­¥éª¤ä¾¿æ˜¯ç‰¹å¾åŒ–å‘é‡çš„ç¬¬ä¸€æ­¥ã€‚æ¯æ£µè¯­æ³•æ ‘ï¼Œ å°†è¢«æ˜ å°„åˆ°ç©ºé—´Sä¸­ï¼Œ Sç©ºé—´æœ‰ä¸‰ç§å®šä¹‰æ–¹å¼ï¼š1.æ˜¯åªä¿ç•™API nodesçš„èŠ‚ç‚¹ï¼Œå…¶ä»–èŠ‚ç‚¹å¿½ç•¥ï¼› 2. ä¿ç•™API nodeså’Œè¯­æ³•ç»“æ„ï¼Œå³åœ¨Då±‚å†…å‘ç°ä¸€ä¸ªAPI nodes(Dåœ¨å®é™…ä½¿ç”¨æ—¶ä¸º3å±‚), å°±åŒ…æ‹¬è¿™æ£µæ ‘ï¼Œå¹¶æŠŠæ‰€æœ‰éAPI nodesçš„èŠ‚ç‚¹å…¨ç”¨å ä½ç¬¦ä»£æ›¿ã€‚3. ä¸2ç›¸åŒï¼Œä½†æ˜¯è¿˜ä¿ç•™äº†syntax nodesã€‚
  æœ‰äº†è¿™ä¸‰ç§å¯¹å‘é‡ç©ºé—´é›†åˆSçš„å®šä¹‰ï¼Œ æˆ‘ä»¬å¯¹ç›®æ ‡code baseä¸­çš„æ¯ä¸€ä¸ªfunctionéƒ½æœ‰äº†ä¸‰ä¸ªè¯„ä¼°è§’åº¦ï¼Œç›¸å½“äºç»™äº†ä¸‰ç§ç”±ç®€å•åˆ°å¤æ‚çš„åŒ¹é…æ¨¡å¼ã€‚
  æœ‰äº†è¿™ä¸ªç©ºé—´Sçš„å®šä¹‰åï¼Œ æˆ‘ä»¬å°±å¯ä»¥å®šä¹‰ä¸€ä¸ªæ˜ å°„I,å°†æ¯æ£µæ ‘æ˜ å°„åˆ°Sä¸­ã€‚ä»¥ä¸Šæ ‘(ğŸŒ²)ä¸ºä¾‹å­ï¼Œå¦‚æœæ˜ å°„çš„API nodesç©ºé—´(ç¬¬ä¸€ç§åªåŒ…å«API nodesçš„)ï¼Œé‚£ä¹ˆè¿™é¢—ASTå°±ä¼šè¡¨ç¤ºæˆä¸‰ä¸ªå‘é‡x=[param:int, decl: int, call:bar],æ­¤æ—¶åœ¨æ•´ä¸ªcode baseçš„å¤§API nodesç©ºé—´Sä¸­ï¼Œå°±å¯ä»¥è¡¨ç¤ºä¸€ä¸ªçŸ©é˜µM(s*x)(çŸ©é˜µåœ¨æ˜ å°„æ—¶è¿˜åŠ äº†ä¸€ä¸ªTF-IDFæƒå€¼ï¼Œè¿˜ä¸æ˜¯å¾ˆæ‡‚ï¼Œåªè¯´æ˜¯èƒ½å»æ‰ä¸€äº›å®é™…ç›¸ä¼¼åº¦ä¸é«˜çš„)ã€‚å¯ä»¥çœ‹åˆ°è¿™é¢—ASTåªæœ‰ä¸‰ä¸ªç»´åº¦ï¼Œå› æ­¤åœ¨æ•´ä¸ªç©ºé—´ä¸Šéå¸¸ç¨€ç–ï¼Œå› æ­¤å®é™…ä½¿ç”¨æ—¶æ˜“äºæ¯”è¾ƒã€‚
  - 3. Identification of API usage patterns.  ç®€è¿°ä¸€ä¸‹ï¼šè¿™ä¸€æ­¥æ˜¯ä¸ºäº†è®©åŠŸèƒ½ç›¸è¿‘çš„å‡½æ•°æœ‰ä¸€ä¸ªç›¸å…³åº¦ï¼Œä½¿ç”¨äº†ä¸€ç§latent semantic analysisçš„è¯­ä¹‰åˆ†ææŠ€æœ¯ï¼Œ è¯¥æŠ€æœ¯å¸¸ç”¨äºå¯¹è‡ªç„¶è¯­è¨€ä¸­ï¼Œæ–‡æ¡£ä¸»é¢˜çš„åˆ¤å®šã€‚ å°†çŸ©é˜µMæ‹†åˆ†æˆäº†ä¸‰ä¸ªï¼Œå…¶ä¸­ä¸€ä¸ªå‘é‡è¡¨ç¤ºäº†ç›¸å…³åº¦ã€‚
  - 4. Assisted vulnerability discovery. è¿™ä¸€æ­¥å°±æ˜¯æ‰¾æ¼æ´äº†ã€‚ä½¿ç”¨ä¸Šä¸€æ­¥çš„ä¸‰ä¸ªçŸ©é˜µè¿›è¡Œæ¯”è¾ƒã€‚


  
> æ–‡ç« æŠŠä¸‰ç±»èŠ‚ç‚¹åˆ†å®šä¸º`API`: `parameters types, declaration types and function calls`,ç¬¬äºŒç±»ä¸æ˜¯å¾ˆæ‡‚ã€‚

# EVALUATION
 è®¾è®¡äº†æ•°é‡ä¸Šå’Œè´¨é‡ä¸Šçš„ä¸¤ç§è¯„ä¼°ï¼Œ è¯„ä¼°ç›®æ ‡æ˜¯å››ä¸ªè½¯ä»¶(LibTIFF, Pidgin, FFmpeg, Asterisk)ã€‚

# æ€»ç»“
- æ–‡ç« ä¸­ä»ASTä¸Šæä¸€äº›æ„Ÿå…´è¶£çš„ç‚¹ç„¶åç”Ÿæˆå‘é‡çš„æ€è·¯æ„Ÿè§‰è¿˜æ˜¯å¾ˆå¥½çš„ã€‚
- æœ€è¿‘è¶Šå‘è§‰å¾—ï¼Œä¸ç®¡æ˜¯joern,rips,pixyç­‰ç­‰ï¼Œä»–ä»¬éƒ½æ˜¯å…ˆæ­ä¸€ä¸ªæ¡†æ¶ï¼Œç„¶ååœ¨ä¸Šé¢å»è§£å†³æŸä¸€ä¸ªé—®é¢˜ç‚¹ã€‚è¿™ä¸­æ¨¡å¼å¯èƒ½æ¯”è¾ƒé€‚åˆæˆ‘å»åšã€‚

# reference
[[1] Vulnerability Extrapolation:
Assisted Discovery of Vulnerabilities using Machine Learning](https://www.usenix.org/legacy/events/woot11/tech/final_files/Yamaguchi.pdf)
